{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { useRoute } from 'vue-router';\nimport { onMounted, ref } from 'vue';\nimport { firebaseApp } from '@/firebase';\nimport { Timestamp, addDoc, and, collection, doc, getDoc, getDocs, getFirestore, or, orderBy, query, where } from 'firebase/firestore';\nimport { useAuthStore } from '@/stores/auth';\nimport SentTextMessage from './messages/SentTextMessage.vue';\nimport ReceivedTextMessage from './messages/ReceivedTextMessage.vue';\nimport SentImageMessage from './messages/SentImageMessage.vue';\nimport ReceivedImageMessage from './messages/ReceivedImageMessage.vue';\nexport default {\n  __name: 'MessagesPage',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const route = useRoute();\n    const auth = useAuthStore();\n    let textContent = ref('');\n    let nickname = ref('');\n    let messages = ref([]);\n    let components = ref([]);\n    let initial = true;\n    onMounted(() => {\n      updateMessages();\n    });\n    function photoUploaded(event) {\n      let file = event.target.files[0];\n      const uuid = console.log(crypto.randomUUID());\n      file.name = uuid;\n      console.log(file);\n    }\n    function updateMessages() {\n      const db = getFirestore(firebaseApp);\n      const messagesColRef = collection(db, \"messages\");\n      const userDocRef = doc(db, \"users\", route.params.uid);\n      messages.value = [];\n      getDoc(userDocRef).then(snapshot => {\n        if (snapshot.exists()) {\n          nickname.value = snapshot.data().nickname;\n          console.log(nickname.value);\n        }\n      });\n      const q = query(messagesColRef, or(and(where('from', '==', auth.user.uid), where('to', '==', route.params.uid)), (where('to', '==', auth.user.uid), where('from', '==', route.params.uid))), orderBy('timestamp', 'desc'));\n      getDocs(q).then(snapshot => {\n        snapshot.forEach(doc => {\n          let data = doc.data();\n          messages.value.push({\n            'id': doc.id,\n            ...data\n          });\n        });\n        console.log(messages.value);\n        messages.value.forEach(message => {\n          const id = message.id;\n          const type = message.type;\n          const sent = message.from === auth.user.uid;\n          const content = message.content;\n          if (!components.value.map(c => c.id).includes(id)) {\n            if (initial) {\n              switch (type) {\n                case 'text':\n                  if (sent) {\n                    components.value.push({\n                      'id': id,\n                      'name': SentTextMessage,\n                      'content': content\n                    });\n                  } else {\n                    components.value.push({\n                      'id': id,\n                      'name': ReceivedTextMessage,\n                      'content': content\n                    });\n                  }\n                  break;\n                case 'image':\n                  if (sent) {\n                    components.value.push({\n                      'id': id,\n                      'name': SentImageMessage,\n                      'content': content\n                    });\n                  } else {\n                    components.value.push({\n                      'id': id,\n                      'name': ReceivedImageMessage,\n                      'content': content\n                    });\n                  }\n                  break;\n              }\n            } else {\n              switch (type) {\n                case 'text':\n                  if (sent) {\n                    components.value.unshift({\n                      'id': id,\n                      'name': SentTextMessage,\n                      'content': content\n                    });\n                  } else {\n                    components.value.unshift({\n                      'id': id,\n                      'name': ReceivedTextMessage,\n                      'content': content\n                    });\n                  }\n                  break;\n                case 'image':\n                  if (sent) {\n                    components.value.unshift({\n                      'id': id,\n                      'name': SentImageMessage,\n                      'content': content\n                    });\n                  } else {\n                    components.value.unshift({\n                      'id': id,\n                      'name': ReceivedImageMessage,\n                      'content': content\n                    });\n                  }\n                  break;\n              }\n            }\n          }\n        });\n        if (initial) initial = !initial;\n      });\n    }\n    function sendMessage() {\n      const db = getFirestore(firebaseApp);\n      const messagesColRef = collection(db, \"messages\");\n      const newMessage = {\n        from: auth.user.uid,\n        to: route.params.uid,\n        type: 'text',\n        timestamp: Timestamp.fromDate(new Date(Date.now())),\n        content: textContent.value.value\n      };\n      addDoc(messagesColRef, newMessage).then(() => {\n        updateMessages();\n        textContent.value.value = '';\n      });\n    }\n    const __returned__ = {\n      route,\n      auth,\n      get textContent() {\n        return textContent;\n      },\n      set textContent(v) {\n        textContent = v;\n      },\n      get nickname() {\n        return nickname;\n      },\n      set nickname(v) {\n        nickname = v;\n      },\n      get messages() {\n        return messages;\n      },\n      set messages(v) {\n        messages = v;\n      },\n      get components() {\n        return components;\n      },\n      set components(v) {\n        components = v;\n      },\n      get initial() {\n        return initial;\n      },\n      set initial(v) {\n        initial = v;\n      },\n      photoUploaded,\n      updateMessages,\n      sendMessage,\n      get useRoute() {\n        return useRoute;\n      },\n      onMounted,\n      ref,\n      get firebaseApp() {\n        return firebaseApp;\n      },\n      get Timestamp() {\n        return Timestamp;\n      },\n      get addDoc() {\n        return addDoc;\n      },\n      get and() {\n        return and;\n      },\n      get collection() {\n        return collection;\n      },\n      get doc() {\n        return doc;\n      },\n      get getDoc() {\n        return getDoc;\n      },\n      get getDocs() {\n        return getDocs;\n      },\n      get getFirestore() {\n        return getFirestore;\n      },\n      get or() {\n        return or;\n      },\n      get orderBy() {\n        return orderBy;\n      },\n      get query() {\n        return query;\n      },\n      get where() {\n        return where;\n      },\n      get useAuthStore() {\n        return useAuthStore;\n      },\n      SentTextMessage,\n      ReceivedTextMessage,\n      SentImageMessage,\n      ReceivedImageMessage\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["useRoute","onMounted","ref","firebaseApp","Timestamp","addDoc","and","collection","doc","getDoc","getDocs","getFirestore","or","orderBy","query","where","useAuthStore","SentTextMessage","ReceivedTextMessage","SentImageMessage","ReceivedImageMessage","route","auth","textContent","nickname","messages","components","initial","updateMessages","photoUploaded","event","file","target","files","uuid","console","log","crypto","randomUUID","name","db","messagesColRef","userDocRef","params","uid","value","then","snapshot","exists","data","q","user","forEach","push","id","message","type","sent","from","content","map","c","includes","unshift","sendMessage","newMessage","to","timestamp","fromDate","Date","now"],"sources":["D:/UserData/Desktop/UEK/PSM/KKDP/psm-project/src/components/MessagesPage.vue"],"sourcesContent":["<template>\r\n    <div class=\"container\">\r\n        <header>{{ nickname }}</header>\r\n        <div class=\"content\">\r\n            <component v-for=\"component in components\" :is=\"component.name\" :key=\"component.id\" :content=\"component.content\"></component>\r\n        </div>\r\n        <footer>\r\n            <img @click=\"openCamera\" src=\"camera.png\" width=\"30px\"/>\r\n            <label for=\"photoUpload\">\r\n                <input id=\"photoUpload\" type=\"file\" accept=\"image/png,image/jpeg\" @change=\"photoUploaded\">\r\n                <img @click=\"openImages\" src=\"images.png\" width=\"30px\"/>\r\n            </label>\r\n            <img @click=\"openAudio\" src=\"mic.png\" width=\"30px\"/>\r\n            <textarea ref=\"textContent\"></textarea>\r\n            <img @click=\"sendMessage\" src=\"send.png\" width=\"30px\"/>\r\n        </footer>\r\n    </div>\r\n</template>\r\n\r\n<style>\r\n    .container {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 100%;\r\n        width: 100%;\r\n        background-color: #eee;\r\n    }\r\n\r\n    #photoUpload {\r\n        display: none;\r\n    }\r\n\r\n    .container header, footer {\r\n        padding: 10px;\r\n    }\r\n    .container .content {\r\n        flex: 1 1 auto;\r\n        display: flex;\r\n        flex-direction: column-reverse;\r\n        overflow-y: auto;\r\n        min-height: 0px;\r\n    }\r\n\r\n    footer {\r\n        display: flex;\r\n        align-items: center;\r\n    }\r\n\r\n    footer textarea {\r\n        flex: 1 1 auto;\r\n        height: 50px;\r\n    }\r\n\r\n    footer img {\r\n        margin: 5px;\r\n    }\r\n\r\n\r\n</style>\r\n\r\n<script setup>\r\n    import { useRoute } from 'vue-router';\r\n    import { onMounted, ref } from 'vue';\r\n    import { firebaseApp } from '@/firebase';\r\n    import { Timestamp, addDoc, and, collection, doc, getDoc, getDocs, getFirestore, or, orderBy, query, where } from 'firebase/firestore';\r\n    import { useAuthStore } from '@/stores/auth';\r\n    import SentTextMessage from './messages/SentTextMessage.vue';\r\n    import ReceivedTextMessage from './messages/ReceivedTextMessage.vue';\r\n    import SentImageMessage from './messages/SentImageMessage.vue';\r\n    import ReceivedImageMessage from './messages/ReceivedImageMessage.vue';\r\n    const route = useRoute();\r\n    const auth = useAuthStore();\r\n\r\n    let textContent = ref('');\r\n    let nickname = ref('');\r\n    let messages = ref([]);\r\n    let components = ref([]);\r\n    let initial = true;\r\n    onMounted(() => {\r\n        updateMessages();\r\n    });\r\n\r\n    function photoUploaded(event) {\r\n        let file = event.target.files[0];\r\n        const uuid = console.log(crypto.randomUUID());\r\n        file.name = uuid;\r\n\r\n        console.log(file);\r\n    }\r\n\r\n    function updateMessages() {\r\n        const db = getFirestore(firebaseApp)\r\n        const messagesColRef = collection(db, \"messages\");\r\n        const userDocRef = doc(db, \"users\", route.params.uid);\r\n        messages.value = [];\r\n        getDoc(userDocRef)\r\n        .then((snapshot) => {\r\n            if(snapshot.exists()) {\r\n                nickname.value = snapshot.data().nickname;\r\n                console.log(nickname.value);\r\n            }\r\n        })\r\n\r\n        const q = query(messagesColRef, or(and(where('from', '==', auth.user.uid), where('to', '==', route.params.uid)), (where('to', '==', auth.user.uid), where('from', '==', route.params.uid))), orderBy('timestamp', 'desc'));\r\n        getDocs(q)\r\n        .then((snapshot) => {\r\n            snapshot.forEach((doc) => {\r\n                let data = doc.data();\r\n                messages.value.push({'id': doc.id, ...data});\r\n            });\r\n            console.log(messages.value);\r\n            messages.value.forEach((message) => {\r\n                const id = message.id;\r\n                const type = message.type;\r\n                const sent = message.from === auth.user.uid;\r\n                const content = message.content;\r\n                if(!components.value.map((c) => c.id).includes(id)) {\r\n                    if(initial) {\r\n                        switch(type) {\r\n                    case 'text':\r\n                        if(sent) {\r\n                            components.value.push({\r\n                                'id': id,\r\n                                'name': SentTextMessage,\r\n                                'content': content\r\n                            });\r\n                        } else {\r\n                            components.value.push({\r\n                                'id': id,\r\n                                'name': ReceivedTextMessage,\r\n                                'content': content\r\n                            });\r\n                        }\r\n                        break;\r\n                    case 'image':\r\n                    if(sent) {\r\n                            components.value.push({\r\n                                'id': id,\r\n                                'name': SentImageMessage,\r\n                                'content': content\r\n                            });\r\n                        } else {\r\n                            components.value.push({\r\n                                'id': id,\r\n                                'name': ReceivedImageMessage,\r\n                                'content': content\r\n                            });\r\n                        }\r\n                        break;\r\n                }\r\n                    } else {\r\n                        switch(type) {\r\n                    case 'text':\r\n                        if(sent) {\r\n                            components.value.unshift({\r\n                                'id': id,\r\n                                'name': SentTextMessage,\r\n                                'content': content\r\n                            });\r\n                        } else {\r\n                            components.value.unshift({\r\n                                'id': id,\r\n                                'name': ReceivedTextMessage,\r\n                                'content': content\r\n                            });\r\n                        }\r\n                        break;\r\n                    case 'image':\r\n                    if(sent) {\r\n                            components.value.unshift({\r\n                                'id': id,\r\n                                'name': SentImageMessage,\r\n                                'content': content\r\n                            });\r\n                        } else {\r\n                            components.value.unshift({\r\n                                'id': id,\r\n                                'name': ReceivedImageMessage,\r\n                                'content': content\r\n                            });\r\n                        }\r\n                        break;\r\n                }\r\n                    }\r\n\r\n                }\r\n                \r\n            });\r\n\r\n            if(initial) initial = !initial;\r\n        })\r\n    }\r\n\r\n    function sendMessage() {\r\n        const db = getFirestore(firebaseApp);\r\n        const messagesColRef = collection(db, \"messages\");\r\n        const newMessage = {\r\n            from: auth.user.uid,\r\n            to: route.params.uid,\r\n            type: 'text',\r\n            timestamp: Timestamp.fromDate(new Date(Date.now())),\r\n            content: textContent.value.value\r\n        };\r\n        addDoc(messagesColRef, newMessage)\r\n        .then(() => {\r\n            updateMessages();\r\n            textContent.value.value = '';\r\n        })\r\n\r\n    }\r\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}